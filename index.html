<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    TsaiKD Blog
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">

  <meta property="og:title" content="TsaiKD Blog" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://tsaikd.org/blog/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://tsaikd.org/blog/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="http://tsaikd.org/blog/index.xml" rel="alternate" type="application/rss+xml" title="TsaiKD Blog" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-151772-4", 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>
    <div id="layout" class="pure-g">
        <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

    <a href="http://tsaikd.org/blog"><h1 class="brand-title">TsaiKD Blog</h1></a>
    

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://github.com/tsaikd">GitHub</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="https://www.facebook.com/tsaikd" target="_blank"><i class='fa fa-facebook'></i></a>
        
      
      
    </div>
    

  </div>
</div>


        <div class="content pure-u-1 pure-u-md-3-4">
            <a name="top"></a>
            

          <div class="posts">
            
            
            <section  class="post">
                <header class="post-header">
                    
                    <h1 class="post-title">
                      <a href="/blog/2015/02-08-mac-ssh-agent-forward/">SSH Agent Forward in Mac OS X Yosemite</a>
                  </h1>
              </header>
              <p class="post-meta">
                  
                  <span class="post-date">
                    <span class="post-date-day"><sup>8</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Feb</span> <span class="post-date-year">2015</span>
                </span>
                
                
                    
                
                
                
                <div class="post-categories">
                    
                    
                    <a class="post-category post-category-mac" href="http://tsaikd.org/blog/tags/mac">Mac</a>
                    
                    <a class="post-category post-category-yosemite" href="http://tsaikd.org/blog/tags/yosemite">Yosemite</a>
                    
                    <a class="post-category post-category-ssh" href="http://tsaikd.org/blog/tags/ssh">ssh</a>
                    
                </div>
                
            </p>
            <article class="post-summary">
                  在原生的 Ubuntu ssh agent forward 只要多加一個參數就可以搞定了，沒想到在我的 MBA 上 面搞了好久才搞定。在 Google 上面找了一堆參考資料，但是大多都不完整，還有找到要用 brew 裝新 的 openssh 的解法，不過其實也沒那麼麻煩，就弄個指令，加上修改個檔案而已。 先把你的 private key 存到系統裡面 ssh-add -K ~/.ssh/id_rsa 修改 bashrc eval $(ssh-agent) function _cleanup_ssh_agent { echo &quot;Killing SSH-Agent&quot; kill -9 $SSH_AGENT_PID } trap _cleanup_ssh_agent EXIT 開新的 terminal 的時候就可以用 agent forward 啦
              </article>
              <div class="read-more-link">
                  <a href="/blog/2015/02-08-mac-ssh-agent-forward/"><span class="read-more-slashes">//</span>Read More...</a>
              </div>
          </section>
          
            <section  class="post">
                <header class="post-header">
                    
                    <h1 class="post-title">
                      <a href="/blog/2015/02-03-hack-hugo-to-github-compatiable/">Hack Hugo to GitHub compatiable</a>
                  </h1>
              </header>
              <p class="post-meta">
                  
                  <span class="post-date">
                    <span class="post-date-day"><sup>3</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Feb</span> <span class="post-date-year">2015</span>
                </span>
                
                
                    
                
                
                
                <div class="post-categories">
                    
                    
                    <a class="post-category post-category-golang" href="http://tsaikd.org/blog/tags/golang">golang</a>
                    
                    <a class="post-category post-category-hugo" href="http://tsaikd.org/blog/tags/hugo">hugo</a>
                    
                    <a class="post-category post-category-github" href="http://tsaikd.org/blog/tags/github">github</a>
                    
                </div>
                
            </p>
            <article class="post-summary">
                  在很久之前的文章(練習用 markdown 的形式來寫 blog) 裡面有提到用 gor 來產生靜態的 Blog 網站，不過最近有個叫 Hugo 的東西看起來好像比較 威猛一點，就花了一些時間試看看，雖然最後有達到基本的需求，不過中間花了不少時間在 Hack Hugo &gt;&quot;&lt; ，紀錄一下修改的過程跟一些我自己想要的額外效果給大家參考。 因為 Hugo 的改版還蠻快的，而且我不是很喜歡 git merge 的樹狀結構長的很醜，所以就附上 相關的 Patch 檔案，如果是直接看我的 GitHub Hugo 的話，那個 commit hash 是會一直變動的唷！ 檢查副檔名改成全用小寫檢查 因為有時後會遇到副檔名大小寫混用的情況，統一用小寫檢查比較方便。 直接複製檔案到發布目錄 Hugo 遇到不認識的副檔名會報錯，加個 handler 讓他把一些檔案直接丟到發布目錄裡面， 其實在 Hugo 的官方說明文件是要用一個 asset 的目錄去放奇奇怪怪的檔案的，但是我覺得 如果可以跟 Markdown 文件放在一起的話，還是比較方便，因為這樣就可以用相對路徑了。 新增 ModTime 資訊 Hugo 原本產生 Sitemap 的時間欄位是用文件內容提供的 date 欄位，但是我覺 得應該要用，檔案系統上面的 modtime 資訊會比較好。 處理 GitHub 的 README.md 把 README.md 變成 index.html 批量修改相依性程式碼 因為有 Hack 一些程式碼，所以相依性的設定要一併修改，檔案很多，跑
              </article>
              <div class="read-more-link">
                  <a href="/blog/2015/02-03-hack-hugo-to-github-compatiable/"><span class="read-more-slashes">//</span>Read More...</a>
              </div>
          </section>
          
            <section  class="post">
                <header class="post-header">
                    
                    <h1 class="post-title">
                      <a href="/blog/2015/01-23-gogstash-redis-logstash-elasticsearch-kibana/">中等規模環境下的集中式 Log 管理及分析</a>
                  </h1>
              </header>
              <p class="post-meta">
                  
                  <span class="post-date">
                    <span class="post-date-day"><sup>23</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Jan</span> <span class="post-date-year">2015</span>
                </span>
                
                
                    
                
                
                
                <div class="post-categories">
                    
                    
                    <a class="post-category post-category-gogstash" href="http://tsaikd.org/blog/tags/gogstash">gogstash</a>
                    
                    <a class="post-category post-category-redis" href="http://tsaikd.org/blog/tags/redis">Redis</a>
                    
                    <a class="post-category post-category-logstash" href="http://tsaikd.org/blog/tags/logstash">Logstash</a>
                    
                    <a class="post-category post-category-elasticsearch" href="http://tsaikd.org/blog/tags/elasticsearch">ElasticSearch</a>
                    
                    <a class="post-category post-category-kibana" href="http://tsaikd.org/blog/tags/kibana">Kibana</a>
                    
                </div>
                
            </p>
            <article class="post-summary">
                  Log 集中管理可以提供進一步的分析，讓系統管理者在發生問題的時候可以更快的排除錯誤 ，也可以看出某些趨勢，提早做出一些可能有影響的決策。目前其實有不少的工具都可以用 在處理 Log 集中管理的問題，我這邊也提供一個中等規模的解決方案。 在小型的環境(單機，少量程式) Log 其實隨便亂放都沒差，通常都只有在出問題的時候才 會去撈 Log 協助排除問題。在大型的環境(數以百計的主機跟 App 以上)，ㄜ~~~~我沒經驗 不敢隨意猜測。所以這邊是用一個數十台 MongoDB 的環境來討論 Log 集中管理的處理 方式。 在 Logstash 的使用情境下，有幾種典型角色： 這邊偷用了 Logstash Document 的圖 Shipper 蒐集 Broker 暫存 Indexer 解析 Storage &amp; Search 永久儲存 Web Interface 分析界面 Shipper + Broker + Indexer 在小型的環境其實可以整合在同一個 Logstash 裡面一次 處理，不過一開始也有提到，在小型的環境，哪有人在搞複雜的 Log 分析&hellip;XD，既然要做 就一次做到位吧。 不過這邊還有另一個問題，就是 Logstash 是用 Ruby 寫的，然 後透過 Java 來執行，所以需要安裝 Java，但是像在 MongoDB 的環境，我不 想在機器上安裝太多額外的東西，而且 Java 其實還蠻肥的，如果只是單純的 Shipper 角色，沒有必要搞那麼多有的沒的套件把系統弄髒，所以我另外開發了一個小工具 gogstash 來做
              </article>
              <div class="read-more-link">
                  <a href="/blog/2015/01-23-gogstash-redis-logstash-elasticsearch-kibana/"><span class="read-more-slashes">//</span>Read More...</a>
              </div>
          </section>
          
            <section  class="post">
                <header class="post-header">
                    
                    <h1 class="post-title">
                      <a href="/blog/2014/12-25-Docker-infra/">Docker Infra 架構簡介與實例</a>
                  </h1>
              </header>
              <p class="post-meta">
                  
                  <span class="post-date">
                    <span class="post-date-day"><sup>25</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Dec</span> <span class="post-date-year">2014</span>
                </span>
                
                
                    
                
                
                
                <div class="post-categories">
                    
                    
                    <a class="post-category post-category-docker" href="http://tsaikd.org/blog/tags/docker">Docker</a>
                    
                    <a class="post-category post-category-etcd" href="http://tsaikd.org/blog/tags/etcd">Etcd</a>
                    
                    <a class="post-category post-category-skydns" href="http://tsaikd.org/blog/tags/skydns">SkyDNS</a>
                    
                    <a class="post-category post-category-registrator" href="http://tsaikd.org/blog/tags/registrator">Registrator</a>
                    
                    <a class="post-category post-category-nginx" href="http://tsaikd.org/blog/tags/nginx">Nginx</a>
                    
                    <a class="post-category post-category-confd" href="http://tsaikd.org/blog/tags/confd">Confd</a>
                    
                    <a class="post-category post-category-fig" href="http://tsaikd.org/blog/tags/fig">Fig</a>
                    
                    <a class="post-category post-category-docker-builder" href="http://tsaikd.org/blog/tags/docker-builder">Docker-Builder</a>
                    
                    <a class="post-category post-category-kdocker-web" href="http://tsaikd.org/blog/tags/kdocker-web">KDocker-Web</a>
                    
                    <a class="post-category post-category-ubuntu" href="http://tsaikd.org/blog/tags/ubuntu">Ubuntu</a>
                    
                </div>
                
            </p>
            <article class="post-summary">
                  這邊介紹的架構可以做到什麼效果? 開新的 Web App 就可以立刻透過新的 domain name 去連線 開一大堆同名的 Web App 就可以立刻分流 系統基本架構圖 Etcd 存放設定的 Cluster DB SkyDNS 從 Etcd 讀取設定, 讓使用者查詢的 DNS Server Confd 從 Etcd 讀取設定, Reload Nginx Registrator 監聽 Docker Events, 將 Container 資訊寫入 Etcd Nginx 網頁 r-Proxy 實作部份 準備 VM/Host 如果只是要先測試的話, 可以只用一台 VM/Host, 不過考慮到系統容錯的話, 建議準備至少三台不同的機器來建構底層架構 設定 Docker 這邊在 Ubuntu 上安裝 Docker 做為範例, 其他平台請參考官網說明文件 利用 apt 安裝 lxc-docker echo &quot;deb http://get.docker.io/ubuntu docker main&quot; &gt; /etc/apt/sources.list.d/docker.list apt-get update
              </article>
              <div class="read-more-link">
                  <a href="/blog/2014/12-25-Docker-infra/"><span class="read-more-slashes">//</span>Read More...</a>
              </div>
          </section>
          
            <section  class="post">
                <header class="post-header">
                    
                    <h1 class="post-title">
                      <a href="/blog/2014/09-14-Consul-trap/">Consul 採到雷</a>
                  </h1>
              </header>
              <p class="post-meta">
                  
                  <span class="post-date">
                    <span class="post-date-day"><sup>14</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Sep</span> <span class="post-date-year">2014</span>
                </span>
                
                
                    
                
                
                
                <div class="post-categories">
                    
                    
                    <a class="post-category post-category-docker" href="http://tsaikd.org/blog/tags/docker">Docker</a>
                    
                    <a class="post-category post-category-consul" href="http://tsaikd.org/blog/tags/consul">Consul</a>
                    
                    <a class="post-category post-category-lmdb" href="http://tsaikd.org/blog/tags/lmdb">LMDB</a>
                    
                    <a class="post-category post-category-zfs" href="http://tsaikd.org/blog/tags/zfs">ZFS</a>
                    
                    <a class="post-category post-category-ubuntu" href="http://tsaikd.org/blog/tags/ubuntu">Ubuntu</a>
                    
                </div>
                
            </p>
            <article class="post-summary">
                  今天試用 consul ， 看網路上的文件好像還蠻好裝的， 沒想到還是遇到神奇的雷， 目前懷疑是跟 ZFS 有關。 環境 $ uname -rsvmo Linux 3.13.0-35-generic #62-Ubuntu SMP Fri Aug 15 01:58:42 UTC 2014 x86_64 GNU/Linux $ docker -v Docker version 1.2.0, build fa7b24f consul 版本是 v0.4.0 現象 $ docker run progrium/consul -server -bootstrap ==&gt; WARNING: Bootstrap mode enabled! Do not enable unless necessary ==&gt; WARNING: It is highly recommended to set GOMAXPROCS higher than 1 ==&gt; Starting Consul agent... ==&gt; Error starting agent: Failed to start Consul server: Failed to start Raft: index id error: Function not implemented 啟動 consul 就爆炸了&hellip;.&gt;_&lt; google 不到什麼有用的資料， 只好自己 trace code 了&hellip;Orz 追了大半天， 發現問題出在 consul call LMDB (Lightning Memory-Mapped Database) 的時候會死掉。 目前懷疑跟 ZFS 不支援 AIO 有關， 因為 MySQL 跑在 ZFS 上也有災情。 解法 $ docker run -v /tmp progrium/consul -server -bootstrap ==&gt; WARNING: Bootstrap mode enabled!
              </article>
              <div class="read-more-link">
                  <a href="/blog/2014/09-14-Consul-trap/"><span class="read-more-slashes">//</span>Read More...</a>
              </div>
          </section>
          
        </div>

        <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2015. All rights reserved. </p>
</div>
        </div>
    </div>
    
</body>
</html>
